.. |date| date::


Guidance for Programmers
========================

At CoinsManager, we are going to develop a product using the latest
technologies available, for the best user & developer experiences possible.

If you want to contribute, but feel a bit scared by all those frameworks (after
all, we aren't writing any css, javascript or html code), don't be! See that as
a learning experience with free coaching to help you master all those awesome
technologies.


List of technologies used
-------------------------

CSS
~~~
Development tools:

* `Sass <http://sass-lang.com/>`_
* `Compass <http://compass-style.org/>`_
* `Susy <http://susy.oddbird.net/>`_
* `Breakpoint <http://breakpoint-sass.com/>`_

The design workflow looks like this:

.. image:: ../_static/design_parts.png

.. seealso:: `SMACSS <http://smacss.com/book/>`_

Testing tools:

* `Hardy <http://hardy.io/>`_
* `PhantomCSS <https://github.com/Huddle/PhantomCSS>`_
* `Wraith <https://github.com/BBC-News/wraith>`_

HTML
~~~~
* `Jade <http://jade-lang.com/>`_
* `Handlebars <http://handlebarsjs.com/>`_

Javascript
~~~~~~~~~~
Development tools:

* `Meteor <http://www.meteor.com/>`_
* `CoffeeScript <http://coffeescript.org/>`_

Testing tools:

* `Laika <http://arunoda.github.io/laika/>`_
* `Mocha <http://visionmedia.github.io/mocha/>`_
* `Chai <http://chaijs.com/>`_
* `Sinon <http://sinonjs.org/>`_

.. note::

    Meteor is still in beta, and we might face a wall during our
    development. If we cannot resolve it or wait for the v1 to comes out, we'll
    migrate the code to `AngularJS <http://angularjs.org/>`_

All technologies can be represented as below:

.. image:: ../_static/dev_tools.png


Infrastructure
--------------

Here is the current state of the infrastructure (as per |date|)

.. image:: ../_static/infrastructure.png


Workflow
--------

Test code
~~~~~~~~~
Here are all the steps required to run the tests:

.. code-block:: console

    $ cd CoinsManager/
    $ make install && make test

If all goes well, then you should see something like that:

.. image:: ../_static/test_success.png

If you want to use RTD as a Continuous Integration tool in your local
environment, do this instead of `make test`:

.. code-block:: console

    $ cd test/rtd
    $ ./rtd --debug



Running code
------------
.. code-block:: console

    $ cd app/
    $ meteor run --settings settings.json


Deploy code
~~~~~~~~~~~
we need to specify the settings (containing our
`Google Analytics <https://atmosphere.meteor.com/package/GAnalytics>`_ code
among other things) when deploying (note that you need to be a privileged user
with access to the deployment password).

Meteor hosting
^^^^^^^^^^^^^^
Used temporarily to deploy the **Coming Soon Page**

.. code-block:: console

    $ meteor deploy www.coinsmanager.com --password --settings settings.json

Heroku
^^^^^^
First, install the toolbelt.

.. code-block:: console

    $ wget -qO- https://toolbelt.heroku.com/install.sh | sh
    $ echo 'PATH="/usr/local/heroku/bin:$PATH"' >> ~/.profile

Then login with your authorized Heroku account

.. code-block:: console

    $ heroku login

Edit your :file:`.git/config` to add the new heroku remote::

    [remote "heroku"]
        url = git@heroku.com:coinsmanager.git
        fetch = +refs/heads/*:refs/remotes/heroku/*

Now you can push on **heroku** (Heroku git repository) like you would do with
**origin** (your Github fork) or **upstream** (CoinsManager Github repository).
Confer :ref:`Git Remotes <git-remotes>` if needed.

Because heroku doesn't know yet how to compile our `.sass` files into css
(missing feature in the buildpack, or missing **meteor-compass** package to
handle it), we need to compile it ourselves and commit it in git before pushing
it to Heroku.

In the following example, we will deploy the **EXAMPLEBRANCH** branch on Heroku:

.. code-block:: console

    $ git co EXAMPLEBRANCH
    $ cd app/client/compass && compass compile
    $ for file in `find . -name "*css"`; do git add -f $file; done; git ci -am "heroku style"
    $ git push heroku `git subtree split --prefix app EXAMPLEBRANCH`:master --force
    $ git reset --soft HEAD~1 && git reset HEAD .

.. note::

    * the for loop searches for all css files and commit them (by default css
      files are ignored by the repo).
    * the git subtree command is a trick to push only the content from the
      :path:`app/` directory to heroku, which expects the code to be at the root
      directory.
